class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-07-02",
      revision: "3bd99ff836ef9219c4a5f48e3b90ddb8a3ee018d"
  version "2022-07-02"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "41d38384117e69bc4255e7d05f452a36cb2eeb68a104f72efc9d600ea959fb26"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "2c3a9bf475bdf143b727626627482cbea61df60a3d087cabcc6c3362e92c8b9b"
    sha256 cellar: :any_skip_relocation, monterey:       "6d1645dc931373ca193ef56879e4efe76b6ea2628ff0734c0a38bf4558aaa55d"
    sha256 cellar: :any_skip_relocation, big_sur:        "364b478b9ff11f15ee445469491f8f1ee6265415e961c4c6d0012fedc5f543e2"
    sha256 cellar: :any_skip_relocation, catalina:       "65458a879da9d15b31cc69d345138d0bf7415117533391c9f96d8d48c3f2522a"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "29b584c5b160b636a3e463f81ad64f4ef319e4527ba12902cfb319d7aef2009d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
